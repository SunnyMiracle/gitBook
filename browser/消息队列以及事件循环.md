## 消息队列以及事件循环

### Knowledge Points
- 现代浏览器一般都是采用多进程模型的。每一个进程对应一个Tab标签。
- 每一个进程中js的主线程与UI线程其实是一个，两者互斥。
- 但是通过实际使用场景来开，用户的行为相应，点击、拖拽、XHR等都 都是通过相对应的异步线程实现的。
- 比如说定时器线程，网络线程等。
- 回调函数分成了同步回调函数、异步回调函数两种，forEach内的属于同步，setTimeout属于异步
- 主线程会不断的从消息队列中去除任务，进行执行，这个过程称为时间循环。
- 异步线程中的任务执行结束之后，会将指定的回调入队到消息队列中，等待主线程取出执行。
    - 例如网络下载的情况，或者setTimeout的情况。
    
- 宏任务就是指的是消息队列中等待被主线程执行的事件，每个宏任务执行时，V8都会重新创建栈，结束后也会被清空，接着主线程继续执行县一个宏任务。
- 微任务，是一个异步执行的函数，执行时机为当前主函数（同步代码）执行结束之后，当前宏任务执行结束之前。
- 可以理解为 每个宏任务都有一个维护的微任务队列。
- 微任务是基于消息队列、主线程、调用栈而来的，然后延伸出协程、Promise、Generator、await/async
- 调用栈用来管理主线程上函数的调用关系，如果嵌套层次太深，会导致栈溢出的问题。
- 消息队列中的每个任务都是宏任务。
- 协程，协程是一种比线程更加轻量的存在，一个线程上可以运行多个协程，但是同一个时间只允许运行一个协程。
- generator函数就是协程的一种实现
- await/async 技术的秘密就是promise + generator，网底层说就是微任务合协程的应用。
- await 后边可以跟普通的表达式，也可以跟Promise对象，如果是Promise对象的话，只有在resolved之后才会继续执行后续的代码。

综上所述，消息队列是JavaScript主线程执行同步代码、异步代码的机制。主线程会不断轮询去除消息队列中的待执行任务，
消息队列中的任务都是宏任务。但是由于一些宏任务可能会执行很长时间，导致JavaScript执行卡顿，因此引入了更加精细化的
异步任务调节机制 -- 微任务。
